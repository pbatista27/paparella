(function($){
    $.pjax.defaults.timeout = 999999;

    $(document).on("click", 'a[data-role="open-modal"]', function(e) {
        e.preventDefault();
        e.stopPropagation();
        var t = $(this);
        setTimeout(function() {
            window.modal.load($(t).attr("href"))
        }, 250)
    });

    $(document).on("click", '#img-menu-avatar', function(e) {
        e.preventDefault();
        e.stopPropagation();
        var t = $(this);
        setTimeout(function() {
            window.modal.load($(t).data("href"))
        }, 250)
    });

    $(document).on("click", 'a[data-runtime="ajax-confirm"]', function(e) {
        e.preventDefault();
        e.stopPropagation();

        var link = $(this);
        var config = {
            'title'        :  link.data('title-confirm'),
            'icon'         :  link.data('icon-class'),
            'confirm'      : '<div class="text-center padding-v-15">'+ link.data('text-confirm') +'</div>',
            'labelCancel'  : link.data('label-btn-cancel'),
            'labelOk'      : link.data('label-btn-ok'),
            'pjaxContent'  : link.data('pjax-target') || false,
            'redirect'     : link.data('force-redirect') || false,
            'end'          : link.data('end') || false,
        };

        config.callbackOk = function(){
           $.ajax({
                type    : "post",
                url     : link.attr("href"),
                success : function(){

                   switch(true)
                    {
                        case (config.end != false):
                            return;

                        case (config.redirect != false):
                            window.location.href = config.redirect;
                            break;

                        case (config.pjaxContent != false):
                            $.pjax.reload({container: config.pjaxContent});
                            break;

                        default:
                            window.location.reload(true);
                            break;
                    }
                },
                error : function(data){
                    console.log(data);
                    window.location.reload(true);
                }
            });
        };


        modal.confirm(config);
        return false;
    });

    $(document).on("click", '[data-runtime="pjax-refresh"]', function(e) {
        var el = $(this);
        $.pjax.reload({container: el.data("target") });
    });

    $(document).on("pjax:beforeSend", function (e) {
        if($('[role="loader"]').length == 0)
            $("#content").addLoader();
    });

    $(document).on("pjax:complete", function (e) {
        setTimeout(function(){
            $("#content").rmLoader();
        }, 250);
    });

    document.addEventListener("DOMContentLoaded", function() {
        $("body").fadeIn("slow")
    }, false);


   $(document).ready(function() {
        $("#button-menu").on("click", function(e) {
            e.preventDefault(),
            $("#column-left").toggleClass("active")
        });

        $("#menu a[href]").on("click", function() {
            sessionStorage.setItem("menu", $(this).attr("href"))
        });

        if(sessionStorage.getItem("menu") == null)
           return;

        var itemActive = $("#menu a[href='"+ sessionStorage.getItem("menu") +"']");
        itemActive.parent().addClass("active");
        itemActive.parents("li > a").removeClass("collapsed");
        itemActive.parents("ul").addClass("in");
        itemActive.parents("li").addClass("active");
    });
})(jQuery);



